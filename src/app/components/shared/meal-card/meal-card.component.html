<!-- Normal Meal Card View -->
<div class="meal-card" *ngIf="!showEditForm" [class.unavailable]="!meal.isAvailable">
  <div class="meal-image">
    <img [src]="meal.image || 'assets/images/default-meal.jpg'" 
         [alt]="meal.name" 
         class="meal-img"
         (error)="$event.target.src='assets/images/default-meal.jpg'">
    
    <!-- Availability Badge -->
    <div class="availability-badge" [class.available]="meal.isAvailable" [class.unavailable]="!meal.isAvailable">
      {{ meal.isAvailable ? 'Mevcut' : 'Mevcut Değil' }}
    </div>

    <!-- Restaurant Badge (only for customer view) -->
    <div class="restaurant-badge" *ngIf="isCustomer() && restaurantName">
      {{ restaurantName }}
    </div>
  </div>

  <div class="meal-content">
    <div class="meal-header">
      <h3 class="meal-name">{{ meal.name }}</h3>
      <span class="meal-category" *ngIf="meal.category">{{ meal.category }}</span>
    </div>

    <p class="meal-description" *ngIf="meal.description">
      {{ meal.description }}
    </p>

    <div class="meal-footer">
      <div class="price-section">
        <span class="meal-price">{{ formatPrice(meal.price) }}</span>
      </div>

      <!-- Customer Actions -->
      <div class="customer-actions" *ngIf="isCustomer() && meal.isAvailable">
        <div class="quantity-selector">
          <button type="button" class="qty-btn" (click)="decreaseQuantity()" [disabled]="quantity <= 1">-</button>
          <span class="quantity">{{ quantity }}</span>
          <button type="button" class="qty-btn" (click)="increaseQuantity()">+</button>
        </div>
        <button class="add-to-cart-btn" (click)="onAddToCart()">
          <i class="icon-cart"></i>
          Sepete Ekle
        </button>
      </div>

      <!-- Restaurant Actions -->
      <div class="restaurant-actions" *ngIf="canManageMeal()">
        <button class="toggle-availability-btn" 
                [class.make-available]="!meal.isAvailable"
                [class.make-unavailable]="meal.isAvailable"
                (click)="toggleAvailability()">
          {{ meal.isAvailable ? 'Stoktan Çıkar' : 'Stoğa Ekle' }}
        </button>
        <div class="action-buttons">
          <button class="edit-btn" (click)="onEditMeal()">
            <i class="icon-edit"></i>
            Düzenle
          </button>
          <button class="delete-btn" (click)="onDeleteMeal()">
            <i class="icon-delete"></i>
            Sil
          </button>
        </div>
      </div>

      <!-- Read-only view for other restaurants -->
      <div class="readonly-view" *ngIf="isRestaurant() && !canManageMeal()">
        <span class="readonly-label">{{ restaurantName }} menüsü</span>
      </div>
    </div>
  </div>
</div>

<!-- Edit Form -->
<div class="meal-card edit-form" *ngIf="showEditForm">
  <div class="edit-header">
    <h3>Yemek Düzenle</h3>
    <button class="close-btn" (click)="onCancelEdit()">×</button>
  </div>

  <form class="edit-form-content" (ngSubmit)="onSaveMeal()">
    <div class="form-group">
      <label for="mealName">Yemek Adı *</label>
      <input type="text" 
             id="mealName"
             [(ngModel)]="editedMeal.name" 
             name="mealName"
             class="form-input"
             required
             placeholder="Yemek adını giriniz">
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="mealPrice">Fiyat (₺) *</label>
        <input type="number" 
               id="mealPrice"
               [(ngModel)]="editedMeal.price" 
               name="mealPrice"
               class="form-input"
               min="0"
               step="0.01"
               required
               placeholder="0.00">
      </div>

      <div class="form-group">
        <label for="mealCategory">Kategori</label>
        <input type="text" 
               id="mealCategory"
               [(ngModel)]="editedMeal.category" 
               name="mealCategory"
               class="form-input"
               placeholder="Örn: Ana Yemek, Tatlı">
      </div>
    </div>

    <div class="form-group">
      <label for="mealDescription">Açıklama</label>
      <textarea id="mealDescription"
                [(ngModel)]="editedMeal.description" 
                name="mealDescription"
                class="form-textarea"
                rows="3"
                placeholder="Yemek açıklaması..."></textarea>
    </div>

    <div class="form-group">
      <label for="mealImage">Resim URL'si</label>
      <input type="url" 
             id="mealImage"
             [(ngModel)]="editedMeal.image" 
             name="mealImage"
             class="form-input"
             placeholder="https://example.com/image.jpg">
    </div>

    <div class="form-group checkbox-group">
      <label class="checkbox-label">
        <input type="checkbox" 
               [(ngModel)]="editedMeal.isAvailable" 
               name="isAvailable">
        <span class="checkmark"></span>
        Stokta mevcut
      </label>
    </div>

    <div class="form-actions">
      <button type="button" class="cancel-btn" (click)="onCancelEdit()">
        İptal
      </button>
      <button type="submit" class="save-btn" [disabled]="!editedMeal.name || editedMeal.price <= 0">
        Kaydet
      </button>
    </div>
  </form>
</div>